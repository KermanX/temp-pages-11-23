var ie=Object.defineProperty;var oe=(r,e,t)=>e in r?ie(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var a=(r,e,t)=>(oe(r,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();class te{constructor(e,t=()=>{}){a(this,"contextFuncs",{});a(this,"app");this.name=e,this.onInstall=t}registerFunc(e,t){this.contextFuncs[e]=t}outputComponent(e){return t=>(this.contextFuncs[e]=de(t),t)}statusComponent(e){return t=>(this.contextFuncs[e]=me(t),t)}triggerComponent(e){return t=>(this.contextFuncs[e]=ge(t),t)}install(e,...t){this.app=e,this.onInstall(e,...t),Object.assign(e.contextFuncs,this.contextFuncs),console.debug(`plugin ${this.name} installed.`)}}var g=(r=>(r[r.update=0]="update",r[r.recv=1]="recv",r))(g||{});const f=new te("prelude"),L=Symbol("PD");var Oe;class ae{constructor(e,t,s,n){a(this,"$value");a(this,Oe,!0);this.$initializer=t,this.$getter=s,this.$setter=n,this.$value=t(e,this)}get value(){return this.$getter(this.$value,this)}set value(e){this.$value=this.$setter(e,this)}[(Oe=L,Symbol.toPrimitive)](){return this.value}}function c(r){return r!=null&&r[L]?r.value:r}function le(r,e){return r[L]&&r.value!==e?(r.value=e,!0):!1}function se(r,e,t){const s=n=>new ae(n,s.$initializer,s.$getter,s.$setter);return s.$initializer=r,s.$getter=e,s.$setter=t,new Proxy(s,{get(n,i){if(i in n)return n[i];if(i in y)return y[i](n)}})}const T=r=>r,y={};function S(r,e,t,s){return se(e?(n,i)=>r.$initializer(e(n,i,r),i):r.$initializer,t?(n,i)=>t(r.$getter(n,i),i,r):r.$getter,s?(n,i)=>r.$setter(s(n,i,r),i):r.$setter)}se(T,T,T);y.persist=r=>(e,t)=>S(r,s=>{const n=e.getItem(t);return n===null?(e.setItem(t,JSON.stringify(s)),s):JSON.parse(n)},null,s=>(e.setItem(t,JSON.stringify(s)),s));function O(r=null){return{current:r}}function pe(...r){return{mergedCurrent:null,get current(){return this.mergedCurrent},set current(e){this.mergedCurrent=e,r.forEach(t=>{t.current=e})}}}y.trim=r=>S(r,e=>e.trim(),e=>e.trim(),e=>e.trim());y.watch=r=>(e,t=!1)=>S(r,t?(s,n)=>(e(s,void 0,n),s):null,null,(s,n)=>(e(s,n.value,n),s));class ne{constructor(e,t){this.ikey=e,this.node=t}appendTo(e){return e.appendChild(this.node),this.node}prependTo(e){return e.firstChild.before(this.node),this.node}insertAfter(e){return e.after(this.node),this.node}removeFrom(e){e.removeChild(this.node)}}class M extends ne{constructor(){super(...arguments);a(this,"children",[]);a(this,"createdChildren",new Set);a(this,"currentClasses",new Set);a(this,"currentStyle","");a(this,"registeredEventListeners",{})}get $mainEl(){return this.node}createDOM(){let t=null;for(const s of this.children)s.createDOM(),t=s.appendTo(this.node)??t,this.createdChildren.add(s);return{lastEl:t,thisEl:this.node}}updateDOM(){let t=new Set(this.createdChildren),s=null;for(const n of this.children)this.createdChildren.has(n)?(s=n.updateDOM().thisEl??s,t.delete(n)):(n.createDOM(),s?s=n.insertAfter(s)??s:this.node.firstChild?s=n.prependTo(this.node)??s:s=n.appendTo(this.node)??s,n.updateDOM());for(const n of t)n.removeFrom(this.node);return this.createdChildren=new Set(this.children),{lastEl:s,thisEl:this.node}}setClasses(t){for(const s of t)this.currentClasses.has(s)?this.currentClasses.delete(s):this.node.classList.add(s);for(const s of this.currentClasses)this.node.classList.remove(s);this.currentClasses=new Set(t)}addClasses(t){if(t.length>0){this.node.classList.add(...t);for(const s of t)this.currentClasses.add(s)}}setStyle(t){t!==this.currentStyle&&(this.node.style.cssText=t,this.currentStyle=t)}addStyle(t){t.length>0&&(this.node.style.cssText+=t,this.currentStyle+=t)}updateEventListeners(t){const s=this.registeredEventListeners,n={};for(const i in t){const o=t[i];o&&(s[i]?(s[i]=void 0,typeof o=="function"?n[i]=o:n[i]={...o}):typeof o=="function"?(this.node.addEventListener(i,o),n[i]=o):(this.node.addEventListener(i,o.listener,o.options),n[i]={...o}))}for(const i in s){const o=s[i];o&&(typeof o=="function"?this.node.removeEventListener(i,o):this.node.removeEventListener(i,o.listener,o.options))}this.registeredEventListeners=n}}class he extends M{constructor(){super(...arguments);a(this,"childrenToRemove")}createDOM(){let t=null;for(const s of this.children)t=s.createDOM().thisEl??t,this.createdChildren.add(s);return{lastEl:t,thisEl:null}}updateDOM(){let t=null;this.childrenToRemove=new Set(this.createdChildren);for(const s of this.children)this.createdChildren.has(s)?(t=s.updateDOM().thisEl??t,this.childrenToRemove.delete(s)):t=s.createDOM().thisEl??t;return this.createdChildren=new Set(this.children),{lastEl:t,thisEl:null}}mount(t){for(const s of this.children)t===null?this.node.firstChild?t=s.prependTo(this.node)??t:t=s.appendTo(this.node)??t:t=s.insertAfter(t)??t;return t}updateMount(t){for(const s of this.children)this.createdChildren.has(s)||(t?t=s.insertAfter(t)??t:this.node.firstChild?t=s.prependTo(this.node)??t:t=s.appendTo(this.node)??t);for(const s of this.childrenToRemove)s.removeFrom(this.node);return t}unmount(){for(const t of this.createdChildren)t.removeFrom(this.node)}setClasses(t){throw new Error("Cannot reset classes on portal")}setStyle(t){throw new Error("Cannot reset style on portal")}appendTo(t){return null}prependTo(t){return null}insertAfter(t){return null}removeFrom(t){}}f.registerFunc("portal",function(r,e){this.$app.callAndResetHook("afterThisComponent");const t=this.$app.pushKey(r);this.$app.markComponentProcessed(t);const s=this.$app.currentDOMParent;let n=this.$app.refMap.get(t);n||(n=new he(t,this.$app.root.node),this.$app.refMap.set(t,n)),s.children.push(n),this.$app.root.portals.add(n),n.children=[];const i=new b(this);if(this.$setRef(n),this.$isNoPreserve)if(this.$nextNoPreserve==="deep")i.$allNoPreserve=!0;else throw new Error("Portal cannot be no-preserve.");return this.$app.currentDOMParent=n,c(e)(i),this.$app.callAndResetHook("afterThisComponent"),this.$app.currentDOMParent=s,this.$app.popKey(r),n});class ue extends M{constructor(){super(...arguments);a(this,"portals",new Set);a(this,"createdPortals",new Set);a(this,"bodyComponent",new M("body",document.body))}createDOM(){let t=super.createDOM().lastEl;for(const s of this.portals)t=s.mount(t)??t,this.createdPortals.add(s);return{lastEl:t,thisEl:this.node}}updateDOM(){let t=super.updateDOM().lastEl;const s=new Set(this.createdPortals);for(const n of this.portals)this.createdPortals.has(n)?(t=n.updateMount(t)??t,s.delete(n)):t=n.mount(t)??t;for(const n of s)n.unmount();return this.createdPortals=new Set(this.portals),{lastEl:t,thisEl:this.node}}appendTo(t){throw new Error("Cannot append root")}removeFrom(t){throw new Error("Cannot remove root")}prependTo(t){throw new Error("Cannot insert before root")}insertAfter(t){throw new Error("Cannot insert after root")}}class ce extends ne{createDOM(){return{lastEl:null,thisEl:this.node}}updateDOM(){return{lastEl:null,thisEl:this.node}}}class C{constructor(e){a(this,"$nextRef",null);a(this,"$mainEl",null);a(this,"$isNextNodeMain",!1);a(this,"$nextNoPreserve",!1);a(this,"$allNoPreserve",!1);a(this,"$nextProps",{});a(this,"$nextCls",[]);a(this,"$nextCSS","");a(this,"$contextData",{});a(this,"$firstDOMNode",null);a(this,"$firstHTMLELement",null);this.$app=e,e.callPermanentHook("initializeContext",this)}get $update(){return this.$app.update}get $getD(){return c}get $setD(){return this.$app.setD}$setMaybe(e,t){e.value=t,this.$update()}$clearMaybe(e){e.clear(),this.$update()}get $state(){return this.$app.state}get $updating(){return this.$state===g.update}get $receiving(){return this.$state===g.recv}get $(){return this.$app.eventRecevierRef}get $ev(){return this.$app.eventData}get $root(){return this.$app.root}$ref(e,...t){return this.$nextRef=t.length===0?e:pe(e,...t),!0}$setRef(e){this.$nextRef!==null&&(this.$nextRef.current=e,this.$nextRef=null)}$main(){return this.$isNextNodeMain=!0,!0}$setMainEl(e){this.$isNextNodeMain&&(this.$mainEl=e,this.$isNextNodeMain=!1)}$noPreserve(e=!0){return this.$nextNoPreserve=e?"deep":!0,!0}get $isNoPreserve(){return!!(this.$allNoPreserve||this.$nextNoPreserve)}$prop(e,t){return this.$nextProps[e]=t,!0}$props(e){return Object.assign(this.$nextProps,e),!0}$cls(...e){return this.$nextCls=this.$nextCls.concat((Array.isArray(e[0])?String.raw({raw:e[0]},...e.slice(1)):e[0]).split(/\s/).filter(Boolean)),!0}get $clsToApply(){const e=this.$nextCls;return this.$nextCls=[],e}$css(...e){return this.$nextCSS+=";"+(Array.isArray(e[0])?String.raw({raw:e[0]},...e.slice(1)):e[0]),!0}get $cssToApply(){const e=this.$nextCSS;return this.$nextCSS="",e}$rootCls(...e){return this.$app.pendingRootCls=this.$app.pendingRootCls.concat((Array.isArray(e[0])?String.raw({raw:e[0]},...e.slice(1)):e[0]).split(/\s/).filter(Boolean)),!0}$rootCss(...e){this.$app.pendingRootCSS+=";"+(Array.isArray(e[0])?String.raw({raw:e[0]},...e.slice(1)):e[0])}$bodyCls(...e){return this.$app.pendingBodyCls=this.$app.pendingBodyCls.concat((Array.isArray(e[0])?String.raw({raw:e[0]},...e.slice(1)):e[0]).split(/\s/).filter(Boolean)),!0}$bodyCss(...e){this.$app.pendingBodyCSS+=";"+(Array.isArray(e[0])?String.raw({raw:e[0]},...e.slice(1)):e[0])}get $permanentData(){return this.$app.permanentData}get $runtimeData(){return this.$app.runtimeData}$$(e,t,...s){if(e.startsWith("_svg")&&e[4].toUpperCase()===e[4]){const i=e[4].toLowerCase()+e.slice(5);let[o,p,h]=s;this.$processSVGElement(t,i,this.$clsToApply,this.$cssToApply,o,p,h);return}if(e[0]==="_"){const i=e.slice(1),o=this.$app.htmlElementAlias[i]??i,[p,h,l]=s;this.$processHTMLElement(t,o,this.$clsToApply,this.$cssToApply,p,h,l);return}const n=this.$app.getCustomContextFunc(e);if(!n)throw new Error(`Unknown element ${e}`);return n.call(this,t,...s)}$$t(e,t){if(this.$clsToApply.length>0)throw new Error("Text node cannot have classes");if(this.$cssToApply.length>0)throw new Error("Text node cannot have style");return this.$processTextNode(e,c(t))}$setFirstDOMNode(e){this.$firstDOMNode??(this.$firstDOMNode=e)}$setFirstHTMLELement(e){this.$firstHTMLELement??(this.$firstHTMLELement=e)}$beginComponent(e,t){this.$app.callAndResetHook("afterThisComponent");const s=this.$app.pushKey(e);this.$app.markComponentProcessed(s);let n=this.$app.refMap.get(s);return n||(n=new t(s,this.$app),this.$app.refMap.set(s,n)),this.$setRef(n),n.$props=this.$nextProps,this.$nextProps={},this.$isNoPreserve&&this.$app.noPreserveComponents.add(s),n}$endComponent(e,t){this.$setMainEl(e.$mainEl),this.$app.popKey(t)}$normalizeContent(e=()=>{}){const t=c(e);if(typeof t=="string"||typeof t=="number"){const s=t;return()=>{if(this.$clsToApply.length>0)throw new Error("Text node cannot have classes");if(this.$cssToApply.length>0)throw new Error("Text node cannot have style");this.$processTextNode("_t",String(s))}}return t}$processHTMLElement(e,t,s,n,i={},o,p={}){o=this.$normalizeContent(o),this.$app.callAndResetHook("afterThisComponent");const h=this.$app.pushKey(e);let l=this.$app.refMap.get(h);if(l||(l=new M(h,document.createElement(t)),this.$app.refMap.set(h,l),this.$app.nodeMap.set(l.node,l)),this.$updating){for(const m in i)i[m]===void 0?delete l.node[m]:l.node[m]=i[m];l.setClasses(s),l.setStyle(n),l.updateEventListeners(p)}this.$setRef(l),this.$setMainEl(l.$mainEl),this.$setFirstDOMNode(l),this.$setFirstHTMLELement(l),this.$app.markComponentProcessed(h);const w=new C(this.$app);this.$isNoPreserve&&(this.$app.noPreserveComponents.add(h),this.$nextNoPreserve==="deep"&&(w.$allNoPreserve=!0),this.$nextNoPreserve=!1);const x=this.$app.currentDOMParent;return x.children.push(l),l.children=[],this.$app.currentDOMParent=l,o(w),this.$app.callAndResetHook("afterThisComponent"),this.$app.currentDOMParent=x,this.$app.popKey(e),l}$processSVGElement(e,t,s,n,i={},o,p={}){o=this.$normalizeContent(o),this.$app.callAndResetHook("afterThisComponent");const h=this.$app.pushKey(e);let l=this.$app.refMap.get(h);if(l||(l=new M(h,document.createElementNS("http://www.w3.org/2000/svg",t)),this.$app.refMap.set(h,l),this.$app.nodeMap.set(l.node,l)),this.$updating){for(const m in i){const P=i[m];P===void 0?l.node.removeAttribute(m):typeof P=="function"?l.node[m]=P:l.node.setAttribute(m,String(P)),l.updateEventListeners(p)}l.setClasses(s),l.setStyle(n)}this.$setRef(l),this.$setMainEl(l.$mainEl),this.$setFirstDOMNode(l),this.$setFirstHTMLELement(l),this.$app.markComponentProcessed(h);const w=new C(this.$app);this.$isNoPreserve&&(this.$app.noPreserveComponents.add(h),this.$nextNoPreserve==="deep"&&(w.$allNoPreserve=!0),this.$nextNoPreserve=!1);const x=this.$app.currentDOMParent;return x.children.push(l),l.children=[],this.$app.currentDOMParent=l,o(w),this.$app.callAndResetHook("afterThisComponent"),this.$app.currentDOMParent=x,this.$app.popKey(e),l}$processTextNode(e,t){this.$app.callAndResetHook("afterThisComponent");const s=this.$app.pushKey(e);let n=this.$app.refMap.get(s);return n?this.$updating&&n.node.textContent!==t&&(n.node.textContent=t):(n=new ce(s,document.createTextNode(t)),this.$app.refMap.set(s,n),this.$app.nodeMap.set(n.node,n)),this.$setRef(n),this.$setMainEl(null),this.$setFirstDOMNode(n),this.$app.markComponentProcessed(s),(this.$allNoPreserve||this.$nextNoPreserve)&&(this.$app.noPreserveComponents.add(s),this.$nextNoPreserve=!1),this.$app.currentDOMParent.children.push(n),this.$app.popKey(e),n}}class R{constructor(e,t){a(this,"$mainEl");a(this,"$props");this.$ikey=e,this.$app=t}$update(){this.$app.update()}}class b extends C{constructor(t){super(t.$app);a(this,"$classesArg");a(this,"$styleArg");this.$caller=t,this.$classesArg=t.$clsToApply,this.$styleArg=t.$cssToApply,this.$allNoPreserve=t.$nextNoPreserve==="deep",t.$nextNoPreserve=!1}$setFirstDOMNode(t){super.$setFirstDOMNode(t),this.$caller.$setFirstDOMNode(t)}$setFirstHTMLELement(t){super.$setFirstHTMLELement(t),this.$caller.$setFirstHTMLELement(t)}$main(){return this.$nextCls=this.$classesArg,this.$nextCSS=this.$styleArg,super.$main()}}class $ extends R{}function de(r){return function(e,...t){var i,o,p;const s=this.$beginComponent(e,r),n=new b(this);s.main(n,...t),n.$mainEl||(n.$mainEl=((i=n.$firstHTMLELement)==null?void 0:i.$mainEl)??null,(o=n.$firstHTMLELement)==null||o.addClasses(n.$classesArg),(p=n.$firstHTMLELement)==null||p.addStyle(n.$styleArg)),s.$mainEl=n.$mainEl,this.$endComponent(s,e)}}class $e extends R{constructor(){super(...arguments);a(this,"$_status")}get $status(){return this.$_status}set $status(t){this.$_status!==t&&(this.$_status=t,this.$update())}}class fe extends $e{constructor(){super(...arguments);a(this,"$_status",!1);a(this,"$on",()=>{this.$status=!0});a(this,"$off",()=>{this.$status=!1});a(this,"$toggle",()=>{this.$status=!this.$status})}}function me(r){return function(e,...t){var i,o,p;const s=this.$beginComponent(e,r),n=new b(this);return s.main(n,...t),n.$mainEl||(n.$mainEl=((i=n.$firstHTMLELement)==null?void 0:i.$mainEl)??null,(o=n.$firstHTMLELement)==null||o.addClasses(n.$classesArg),(p=n.$firstHTMLELement)==null||p.addStyle(n.$styleArg)),s.$mainEl=n.$mainEl,this.$endComponent(s,e),s.$status}}class A extends R{constructor(){super(...arguments);a(this,"$fire",t=>(typeof t=="object"&&t!==null&&t instanceof Event&&!Object.hasOwn(t,"$isCurrent")&&(t.$isCurrent=t.target===t.currentTarget),this.$app.recv(this.$ikey,t),!1));a(this,"$fireWith",t=>()=>(this.$fire(t),!1))}}function ge(r){return function(e,...t){var o,p,h;const s=this.$beginComponent(e,r),n=new b(this);s.main(n,...t);const i=this.$app.isReceiver;return n.$mainEl||(n.$mainEl=((o=n.$firstHTMLELement)==null?void 0:o.$mainEl)??null,(p=n.$firstHTMLELement)==null||p.addClasses(n.$classesArg),(h=n.$firstHTMLELement)==null||h.addStyle(n.$styleArg)),s.$mainEl=n.$mainEl,this.$endComponent(s,e),i}}const D=Symbol("async record");f.registerFunc("async",function(r,e,t=""){var h;const s=this.$app.pushKey(r);(h=this.$permanentData)[D]??(h[D]={});const n=this.$permanentData[D];let i=n[s];i||(i=n[s]={state:!1,awaitedValue:void 0},e().then(l=>{i.state=!0,i.awaitedValue=l,this.$update()}).catch(l=>{i.state="error",i.awaitedValue=l,this.$update()})),this.$app.popKey(r);const{state:o,awaitedValue:p}=i;if(o){if(o==="error")throw p;return this[`$awaited${t}`]=p,!0}else return!1});const E=Symbol("await record");f.registerFunc("awaits",function(r,e,t,s=!1){var o;(o=this.$permanentData)[E]??(o[E]={});const n=this.$permanentData[E];if(!s&&n[e])return;n[e]={state:!1,awaitedValue:void 0};const i=n[e];t().then(p=>{i.state=!0,i.awaitedValue=p,this.$update()}).catch(p=>{i.state="error",i.awaitedValue=p,this.$update()})});f.registerFunc("awaited",function(r,e){var s;const t=(s=this.$permanentData[E])==null?void 0:s[e];if(t!=null&&t.state){const{state:n,awaitedValue:i}=t;if(n==="error")throw i;return this[`$awaited${e}`]=i,!0}else return!1});f.registerFunc("documentTitle",function(r,e){return document.title=c(e),!0});var ve=Object.defineProperty,Ce=Object.getOwnPropertyDescriptor,we=(r,e,t,s)=>{for(var n=s>1?void 0:s?Ce(e,t):e,i=r.length-1,o;i>=0;i--)(o=r[i])&&(n=(s?o(e,t,n):o(n))||n);return s&&n&&ve(e,t,n),n};const H=new Map;let F=class extends ${constructor(){super(...arguments);a(this,"$firstDOMNode",null);a(this,"$firstHTMLELement",null)}main(e,t,...s){const n=H.get(this.$ikey)??c(t),i=new C(e.$app);if(typeof n=="function"){const o=n(i,...s);o instanceof Promise?(e.$$t("3-0","Loading module..."),o.then(p=>{H.set(this.$ikey,p.default),e.$app.update()})):(e.$firstDOMNode=this.$firstDOMNode=i.$firstDOMNode,e.$firstHTMLELement=this.$firstHTMLELement=i.$firstHTMLELement)}else e.$$t("3-1",String(n))}};F=we([f.outputComponent("embed")],F);function xe(r){return typeof r=="function"?r:e=>`${e[r]}`}f.registerFunc("for",function(r,e,t,s){this.$app.pushKey(r);const n=xe(t);let i=0;for(const o of c(e)){const p=n(o,i);this.$app.pushKey(p.toString()),s(o,i),this.$app.popKey(p.toString()),i++}return this.$app.popKey(r),!1});f.registerFunc("forRange",function(r,e,t){this.$app.pushKey(r),e=c(e);for(let s=0;s<e;s++){const n=s.toString();this.$app.pushKey(n),t(s),this.$app.popKey(n)}return this.$app.popKey(r),!1});const Ee=(r,e)=>e;var ye=Object.defineProperty,Me=Object.getOwnPropertyDescriptor,Pe=(r,e,t,s)=>{for(var n=s>1?void 0:s?Me(e,t):e,i=r.length-1,o;i>=0;i--)(o=r[i])&&(n=(s?o(e,t,n):o(n))||n);return s&&n&&ye(e,t,n),n};let N=class extends ${main(r,e,t,s,...n){if(typeof e=="symbol"){const i=e,o=t,p=r.$runtimeData[i];r.$runtimeData[i]=o,r.$$("embed","2-0",s,...n),r.$runtimeData[i]=p}else{const i=e,o=Object.getOwnPropertySymbols(i),p={};for(const h of o)p[h]=r.$runtimeData[h],r.$runtimeData[h]=i[h];r.$$("embed","2-1",s,...n);for(const h of o)r.$runtimeData[h]=p[h]}}};N=Pe([f.outputComponent("provide")],N);const v=new Set;f.registerFunc("now",function(r,e=1e3){return this.$updating&&!v.has(r)&&(v.add(r),setTimeout(()=>{v.delete(r),this.$app.update()},e)),Date.now()});f.registerFunc("setInterval",function(r,e,t){this.$updating&&!v.has(r)&&(v.add(r),setTimeout(()=>{v.delete(r),e(),this.$app.update()},t))});class De{constructor(e,t){a(this,"contextFuncs",{});a(this,"htmlElementAlias",{});a(this,"root");a(this,"refMap",new Map);a(this,"nodeMap",new Map);a(this,"_");a(this,"permanentData",{});a(this,"runtimeData");a(this,"noPreserveComponents",new Set);a(this,"processedComponents",new Set);a(this,"currentDOMParent");a(this,"eventRecevier");a(this,"eventData");a(this,"idPrefix");a(this,"state");a(this,"pendingRootCSS");a(this,"pendingRootCls");a(this,"pendingBodyCSS");a(this,"pendingBodyCls");a(this,"mounted",!1);a(this,"running",!1);a(this,"recvQueue",[]);a(this,"needUpdate",!1);a(this,"update",()=>{console.debug("[*] update queued"),this.needUpdate=!0,this.running||this.nextTick()});a(this,"recv",(e,t)=>{console.debug(`[*] recv queued with receiver ${String(e)}`),this.recvQueue.push({receiver:e,data:t}),this.needUpdate=!0,this.running||this.nextTick()});a(this,"runtimeHooks",{});a(this,"permanentHooks",{});a(this,"setD",(e,t)=>le(e,t)?(this.update(),!0):!1);a(this,"registeredWindowEventListeners",{});a(this,"registeredDocumentEventListeners",{});a(this,"registeredRootEventListeners",{});this.main=e,this.rootElementId=t;const s=document.getElementById(t);if(!s)throw new Error(`Root element ${t} not found`);this.root=new ue("_",s),this.resetState()}getCustomContextFunc(e){return this.contextFuncs[e]}markComponentProcessed(e){if(this.processedComponents.has(e))throw new Error(`Component ${e} has already been processed`);this.processedComponents.add(e)}get eventRecevierRef(){if(typeof this.eventRecevier=="symbol")throw new Error(`Cannot get ref of eventRecevier of type symbol: ${String(this.eventRecevier)}`);return this.refMap.get(this.eventRecevier)}get needNextTickRun(){return this.recvQueue.length>0||this.needUpdate}resetState(){this.root.children=[],this.root.portals=new Set,this.currentDOMParent=this.root,this.eventRecevier=null,this.idPrefix=["root"]}mount(){if(this.mounted)throw new Error("App already mounted");setTimeout(()=>{this.execUpdate(),this.callAndResetHook("beforeModifyDOM"),this.root.createDOM(),this.callAndResetHook("afterModifyDOM"),this.runtimeData=void 0,this.mounted=!0},0)}nextTick(){setTimeout(()=>{if(console.debug("[!] next tick"),this.recvQueue.length>0){const{receiver:e,data:t}=this.recvQueue.shift();console.debug(`[+] recv executing start with id ${String(e)}, remaining ${this.recvQueue.length}`);const s=window.performance.now();this.execRecv(e,t),this.runtimeData=void 0,console.debug(`[-] recv executed with id ${String(e)} in ${window.performance.now()-s}ms`),this.nextTick()}else if(this.needUpdate){this.needUpdate=!1,console.debug("[+] update executing start");const e=window.performance.now();this.execUpdate(),this.callAndResetHook("beforeModifyDOM"),this.root.updateDOM(),this.callAndResetHook("afterModifyDOM"),this.runtimeData=void 0,console.debug(`[-] update executed in ${window.performance.now()-e}ms`)}},0)}execMain(){const e=this.ikey;try{if(this.running=!0,this._=new C(this),this.clearEventListeners(),this.runtimeData={},this.processedComponents.clear(),this.callPermanentHook("beforeMain"),this.main(this._),this.callPermanentHook("afterMain"),this._=void 0,e!==this.ikey)throw new Error(`Key mismatch: ${e} !== ${this.ikey}. You may have forgotten to call app.popKey()`);if(this.state===g.update)for(const t of this.noPreserveComponents)this.processedComponents.has(t)||this.refMap.delete(t);window.__MAIN_EXECUTED_TIMES__??(window.__MAIN_EXECUTED_TIMES__=1),console.debug(`main executed ${window.__MAIN_EXECUTED_TIMES__++} times`)}catch(t){console.error("Error when executing main:",t,`
state:`,this.state)}finally{this.running=!1}}execRecv(e,t=null){this.resetState(),this.state=g.recv,this.eventRecevier=e,this.eventData=t,this.execMain()}execUpdate(){this.resetState(),this.state=g.update,this.eventRecevier=null,this.eventData=void 0,this.pendingRootCSS="",this.pendingRootCls=[],this.pendingBodyCSS="",this.pendingBodyCls=[],this.execMain(),this.root.setClasses(this.pendingRootCls),this.root.setStyle(this.pendingRootCSS),this.root.bodyComponent.setClasses(this.pendingBodyCls),this.root.bodyComponent.setStyle(this.pendingBodyCSS)}callAndResetHook(e,...t){const s=this.runtimeHooks[e];if(s)return this.runtimeHooks[e]=void 0,s.map(i=>i(...t));const n=this.permanentHooks[e];return n?n.map(i=>i(...t)):null}callPermanentHook(e,...t){const s=this.permanentHooks[e];return s?s.map(n=>n(...t)):null}pushHook(e,...t){var s;(s=this.runtimeHooks)[e]??(s[e]=[]),this.runtimeHooks[e].push(...t)}addPermanentHook(e,...t){var s;(s=this.permanentHooks)[e]??(s[e]=[]),this.permanentHooks[e].push(...t)}pushKey(e){return this.idPrefix.push(e),this.ikey}popKey(e,t){const s=this.idPrefix.pop();if(e!==s)throw new Error(`idPrefix tag mismatch: want to pop "${e}", but the last is "${s}".

current: ${this.ikey}
message: ${t}`)}get ikey(){return this.idPrefix.join(".")}get isReceiver(){return this.eventRecevier===this.ikey}clearEventListeners(){Object.entries(this.registeredWindowEventListeners).forEach(([e,t])=>t==null?void 0:t.forEach(([s,n])=>window.removeEventListener(e,s,n))),Object.entries(this.registeredDocumentEventListeners).forEach(([e,t])=>t==null?void 0:t.forEach(([s,n])=>document.removeEventListener(e,s,n))),Object.entries(this.registeredRootEventListeners).forEach(([e,t])=>t==null?void 0:t.forEach(([s,n])=>this.root.node.removeEventListener(e,s,n)))}registerWindowEventListener(e,t,s){var n;(n=this.registeredWindowEventListeners)[e]??(n[e]=[]),this.registeredWindowEventListeners[e].push([t,typeof s=="boolean"?s:s==null?void 0:s.capture]),window.addEventListener(e,t,s)}registerDocumentEventListener(e,t,s){var n;(n=this.registeredDocumentEventListeners)[e]??(n[e]=[]),this.registeredDocumentEventListeners[e].push([t,typeof s=="boolean"?s:s==null?void 0:s.capture]),document.addEventListener(e,t,s)}registerRootEventListener(e,t,s){var n;(n=this.registeredRootEventListeners)[e]??(n[e]=[]),this.registeredRootEventListeners[e].push([t,typeof s=="boolean"?s:s==null?void 0:s.capture]),this.root.node.addEventListener(e,t,s)}}function re(){const r=(e,t="root")=>{const s=new De(e,t);return r.plugins.forEach(n=>n(s)),s.mount(),s};return r.plugins=[e=>f.install(e)],r.use=function(e,...t){const s=re();return s.plugins=[...r.plugins,n=>e.install(n,...t)],s},r}const be=re(),u=new te("basics");var Te=Object.defineProperty,Le=Object.getOwnPropertyDescriptor,d=(r,e,t,s)=>{for(var n=s>1?void 0:s?Le(e,t):e,i=r.length-1,o;i>=0;i--)(o=r[i])&&(n=(s?o(e,t,n):o(n))||n);return s&&n&&Te(e,t,n),n};let _=class extends ${main(r,e){r.$$("_div","1-0",{},e)}};_=d([u.outputComponent("div")],_);let B=class extends ${main(r,e){r.$$("_span","1-1",{},e)}};B=d([u.outputComponent("span")],B);let K=class extends ${main(r){r.$$("_br","1-2")}};K=d([u.outputComponent("br")],K);let k=class extends ${main(r,e){r.$$("_h1","1-3",{},e)}};k=d([u.outputComponent("h1")],k);let I=class extends ${main(r,e){r.$$("_h3","1-4",{},e)}};I=d([u.outputComponent("h3")],I);let U=class extends ${main(r,e){r.$$("_h4","1-5",{},e)}};U=d([u.outputComponent("h4")],U);let V=class extends ${main(r,e){r.$$("_h5","1-6",{},e)}};V=d([u.outputComponent("h5")],V);let j=class extends ${main(r,e){r.$$("_h6","1-7",{},e)}};j=d([u.outputComponent("h6")],j);let z=class extends ${main(r,e){r.$$("_p","1-8",{},e)}};z=d([u.outputComponent("p")],z);let W=class extends ${main(r,e,t){r.$$("_a","1-9",{href:c(e)},t)}};W=d([u.outputComponent("a")],W);let Q=class extends A{main(r,e,t=!1){r.$$("_button","1-A",{onclick:s=>{this.$fire(s)},disabled:c(t),type:"button"},c(e))}};Q=d([u.triggerComponent("button")],Q);let J=class extends ${constructor(){super(...arguments);a(this,"inputRef",O())}main(e,t,s,n){e.$ref(this.inputRef)&&e.$$("_input","1-B",{type:"text",disabled:c(s),placeholder:c(n),value:c(t),oninput:()=>{e.$setD(t,this.inputRef.current.node.value)}})}};J=d([u.outputComponent("textInput")],J);let q=class extends A{constructor(){super(...arguments);a(this,"inputRef",O())}main(e,t){e.$ref(this.inputRef)&&e.$$("_input","1-C",{type:"password",value:c(t),oninput:()=>{const s=this.inputRef.current.node.value;e.$setD(t,s),this.$fire(s)}})}};q=d([u.triggerComponent("passwordInput")],q);let G=class extends fe{main(r,e){r.$$("button","1-D",e)&&this.$toggle()}};G=d([u.statusComponent("toggleButton")],G);let X=class extends A{constructor(){super(...arguments);a(this,"inputRef",O())}main(e,t,s=(n=>(n=this.inputRef.current)==null?void 0:n.node.checked)()??!1){e.$$("_label","1-E",{},i=>{i.$$t("1-F",t),i.$ref(this.inputRef)&&i.$$("_input","1-G",{type:"checkbox",onchange:()=>{const o=this.inputRef.current.node.checked;i.$setD(s,o),this.$fire(o)}})})}};X=d([u.triggerComponent("checkbox")],X);let Y=class extends ${main(r,e,t,s){r.$$("_ul","1-H",{},n=>{n.$$("for","1-I",e,t,(i,o)=>{n.$$("_li","1-J",{},p=>{s(i,o)})})})}};Y=d([u.outputComponent("ul")],Y);let Z=class extends ${main(r,e,t=""){r.$$("_img","1-K",{src:c(e),alt:c(t)})}};Z=d([u.outputComponent("img")],Z);const ee=["待完成","待提交","待反馈","已完成"],Se=[{title:"数分P114 第5-14题",subtitle:"下周二",state:0},{title:"代基P191 第8-12题",subtitle:"下周三",state:1},{title:"力学P200 第4-10题",subtitle:"今天",state:1},{title:"数分P110 第1-11题",subtitle:"上周三",state:2},{title:"代基P180 第8-10题",subtitle:"上周二",state:2},{title:"力学P150 第4-12题",subtitle:"上周二",state:3},{title:"程设P110 第5-10题",subtitle:"上周一",state:3},{title:"数分P100 第9-14题",subtitle:"上周一",state:3}];be.use(u)(r=>{r.$cls`border-2 border-black rounded-md p-2 w-[430px] h-[400px] m-auto mt-10`,r.$$("div","0-0",e=>{e.$cls`text-2xl font-bold ml-1 pb-1 border-b-2 border-gray-600`,e.$$("div","0-1","通知"),e.$$("for","0-2",Se.toSorted((t,s)=>t.state-s.state),Ee,t=>{const s=t.state===ee.length-1;e.$cls`h-10 pl-2 flex align items-end ${s?"opacity-50":""}`,e.$$("div","0-3",n=>{n.$cls`text-xl font-bold`,n.$$("span","0-4",t.title),n.$cls`ml-3 mb-[1px]`,n.$$("span","0-5",t.subtitle),n.$cls`grow`,n.$$("_div","0-6"),n.$cls`mx-2 w-32 mb-[2px] border border-black rounded-md text-lg leading-normal`,n.$$("button","0-7",ee[t.state],s)&&t.state++})})})});
